<!DOCTYPE html><html><head><meta charset="UTF-8">
<style>
  html{
   height: 100%;
  }
  body{
    display: flex;
    flex-direction: column;
    height: 100%;
  }
  webview{display: none;flex-grow:1;}
  .curWV{display: inherit !important;}
</style>
<script>
  var wv;
  var engines = {};
  function switchTab(i){
    wv.classList.remove('curWV');
    try {
      wv = document.body.children[i+1];
    }catch(e){}
    wv.classList.add('curWV');
  }
  function onHashChange(){
    let q=location.hash.slice(1);
    console.log(q);
    handleQuery(q);
  }
  function keyPress(e){
    var key = e.key;
    var inputE = document.forms[0].q;
    if (inputE === document.activeElement) return;
    switch (key) {
    case "!":
      inputE.value = ":";
      inputE.focus();
      break;
    case ":":
      inputE.value = "";
      inputE.focus();
      break;
    }
  }
  function getQ(){return document.forms[0].q.value;}
  function bang(query, iSpace){
    let name = query.slice(0,iSpace);
    let engine = engines[name];
    if(engine)
      return engine+query.substring(iSpace+1);
    return "https://www.bing.com/search?q="+query;
  }
  function handleQuery(q){
    var url=q;
    do {
      if(q.length>9){
        let c6 = q.charCodeAt(6);
        if(47==c6){// '/'
          let c5 = q.charCodeAt(5);
          if(47==c5 && 58==q.charCodeAt(4))//http/file urls
            break;
          if(58==c5 && 47==q.charCodeAt(7))//https://
            break;
        }else if(q.startsWith("javascript:")) break;
      }
      let iS = q.indexOf(' ');
      if(iS<0 && q.indexOf('.')>0)
        url = 'http://'+q;
      else
        url = bang(q, iS);
    }while(false);
    wv.src=url;
  }
</script>
</head>
<body>
  <form action="javascript:handleQuery(getQ())">
  <input type="text" name=q style="width:100%"></form>
  <webview class="curWV" style="width:100%"></webview>
  <script>
    wv = document.body.children[1];
    wv.src = location.hash.slice(1);
    window.addEventListener('hashchange',onHashChange);
    document.addEventListener('keydown', keyPress);
  </script>
</body></html>
