<!DOCTYPE html><html><head><meta charset="UTF-8">
<style>
  html{
   height: 100%;
  }
  body{
    display: flex;
    flex-direction: column;
    height: 100%;
  }
  div.webviews{
    display: flex;
    flex-direction: column;
    flex-grow:1;
  }
  webview{display: none;width:100%;height:100%}
  .curWV{display: inherit !important;}
</style>
<script>
  var iTab = 0;
  var tabs;
  var engines = {};
  function switchTab(i){
    tabs.children[iTab].classList.remove('curWV');
    iTab = i;
    tabs.children[iTab].classList.add('curWV');
  }
  function newTab(){
    var tab = document.createElement('webview');
    tab.allowpopups = true;
    tabs.appendChild(tab);
  }
  function tabInc(num){
    let nTabs = tabs.children.length;
    if(nTabs<2) return;
    let i = iTab +num;
    if(i>=nTabs) i=0;
    switchTab(i);
  }
  function tabDec(num){
    let nTabs = tabs.children.length;
    if(nTabs<2) return;
    let i = iTab +num;
    if(i<0) i=nTabs-1;
    switchTab(i);
  }
  function tabClose(){
    let nTabs = tabs.children.length;
    if(nTabs<2) return "";//no remain tab
    tabs.removeChild(tabs.children[iTab]);
    nTabs--;
    if(iTab>=nTabs) iTab=iTab-1;
    tabs.children[iTab].classList.add('curWV');
    return nTabs;
  }
  function appendAutoc(str){
    let dl = document.forms[0].children[0];
    let lines = str.split('\n');
    for(let line of lines){
      let opt = document.createElement('option');
      opt.value = line;
      dl.appendChild(opt);
    }
  }
  function keyPress(e){
    var key = e.key;
    var inputE = document.forms[0].q;
    if (inputE === document.activeElement) return;
    switch (key) {
    case "!":
      inputE.value = ":";
      inputE.focus();
      break;
    case ":":
      inputE.value = "";
      inputE.focus();
      break;
    }
  }
  function getQ(){return document.forms[0].q.value;}
  function bang(query, iSpace){
    let name = query.slice(0,iSpace);
    let engine = engines[name];
    if(engine)
      return engine+query.substring(iSpace+1);
    return "https://www.bing.com/search?q="+query;
  }
  function handleQuery(q){
    var url=q;
    do {
      if(q.length>9){
        let c6 = q.charCodeAt(6);
        if(47==c6){// '/'
          let c5 = q.charCodeAt(5);
          if(47==c5 && 58==q.charCodeAt(4))//http/file urls
            break;
          if(58==c5 && 47==q.charCodeAt(7))//https://
            break;
        }else if(q.startsWith("javascript:")) break;
      }
      let iS = q.indexOf(' ');
      if(iS<0 && q.indexOf('.')>0)
        url = 'http://'+q;
      else
        url = bang(q, iS);
    }while(false);
    tabs.children[iTab].src=url;
  }
</script>
</head>
<body>
  <form action="javascript:handleQuery(getQ())">
  <datalist id="autoc"></datalist>
  <input type="text" list="autoc" name=q style="width:100%" autofocus></form>
  <div class="webviews">
  <webview class="curWV" allowpopups></webview>
  </div>
  <script>
    tabs = document.body.children[1];
    document.addEventListener('keydown', keyPress);
  </script>
</body></html>
